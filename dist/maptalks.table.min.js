/*!
 * maptalks.table v0.1.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks$1)}(this,function(t,e){"use strict";function i(t,e){for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(e,a);s&&s.configurable&&void 0===t[a]&&Object.defineProperty(t,a,s)}return t}var o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},r={title:"title",columns:[{header:"Name",dataIndex:"name",type:"string",maxWidth:50},{header:"Birth",dataIndex:"birth",type:"data",maxWidth:50},{header:"Age",dataIndex:"age",type:"number",maxWidth:50},{header:"Marry",dataIndex:"marry",type:"boolean",trueText:"Yes",falseText:"No",maxWidth:50}],data:[{name:"Tom",birth:"1990-1-1",age:25,marry:"true"},{name:"Peter",birth:"1985-5-1",age:30,marry:"true"},{name:"Mary",birth:"2000-6-1",age:15,marry:"false"}],headerSymbol:{lineColor:"#ffffff",fill:"#4e98dd",textFaceName:"monospace",textSize:12,textFill:"#ebf2f9",textWrapWidth:100},symbol:{lineColor:"#ffffff",fill:"#4e98dd",textFaceName:"monospace",textSize:12,textFill:"#ebf2f9",textWrapWidth:100},position:{x:121.489935,y:31.24432},width:300,height:300,draggable:!0,adjustable:!0,editable:!0,header:!0,order:!0,startNum:1,dynamic:!1,layerId:null},n={NEED_DATA:"You must set data to Table options.",NEED_COLUMN:"You must set columns to Table options."},h=function(t){function e(i){var a;o(this,e);var r=s(this,t.call(this,i));if(r.options.width=r.options.width||300,r.options.height=r.options.height||300,r.options.header||r.options.header===!1||(r.options.header=!0),r.options.order||r.options.order===!1||(r.options.order=!0),r.options.visible=!0,r.options.editing=!1,r.options.adjustable=r.options.adjustable||!0,r.options.showOrderNumber=!0,r.options.startNum=r.options.startNum||1,!r.options.data&&0===r.options.data.length)throw new Error(n.NEED_DATA);if(!r.options.columns&&0===r.options.columns.length)throw new Error(n.NEED_COLUMN);var h=r.options.orderTitle;if(h||(h="No."),r.options.order){for(var l=!0,d=r.options.columns,_=0;_<d.length;_++)if("maptalks_order"===d[_].dataIndex){l=!1;break}if(l){var g=parseInt(r.options.startNum),u={header:h,dataIndex:"maptalks_order",type:"number"};r.options.columns.unshift(u);for(var c=r.options.data,p=0,m=c.length;p<m;p++)c[p].maptalks_order=p+g}}return r._initalColumns=r.options.columns,r._headAttributes=r.options.attributes,r._columns=r.getColumns(),r._colNum=r._columns.length,r._data=r.options.data,r._initalData=r._data,r._rowNum=r._data.length,r.options.header&&(r._rowNum+=1),r._cellWidth=r.options.width/r._colNum,r._cellHeight=r.options.height/r._rowNum,r._currentRow=-1,r._currentCol=-1,r._geometryNumLabels=[],r._rowHeights=[],r._colWidths=[],r.tableWidth=0,r.tableHeight=0,r._initRowHeightAndColWidth(),r.tableSymbols=r._initCellSymbol(),a=r,s(r,a)}return a(e,t),e.prototype.toJSON=function(){return{options:this.options,colums:this._columns,attributes:this._headAttributes,colNum:this._colNum,data:this._dataToJSON(),rowNum:this._rowNum,rowHeights:this._rowHeights,colWidths:this._colWidths,tableWidth:this.tableWidth,tableHeight:this.tableHeight,tableSymbols:this.tableSymbols}},e.prototype._dataToJSON=function(){var t=[];if(this.options.dynamic&&this._data&&this._data.length>0)for(var e,i=0,o=this._data.length;i<o;i++)e=this._data[i],t.push(e);else t=this._data;return t},e.prototype.initByJson=function(t){var e=t.options;this._columns=t.colums,this._colNum=t.colNum,this._headAttributes=t.attributes,this._data=[];var i=t.data;if(e.dynamic&&i&&i.length>0)for(var o,a,s,r=0,n=i.length;r<n;r++)o=i[r],a=o.geometry,a&&(s=maptalks.Geometry.fromJSON(a),o.coordinate=s.getCenter(),o.geometry=null,delete o.geometry),this._data.push(o);else this._data=i;return this._rowNum=t.rowNum,this._rowHeights=t.rowHeights,this._colWidths=t.colWidths,this._tableRows=this._data,this.tableSymbols=t.tableSymbols||this._initCellSymbol(),this},e.prototype.getId=function(){return this.options.id},e.prototype.isDynamic=function(){return this.options.dynamic},e.prototype.getLayerId=function(){return this.options.layerId},e.prototype.getType=function(){return"MAPTALKS_TABLE"},e.prototype.getData=function(){for(var t=[],e=0;e<this._data.length;e++)t.push(this._data[e]);return t},e.prototype.getDataByRowNum=function(t){return this.options.header&&(t-=1),this.getData()[t]},e.prototype.getMaxOrder=function(){return this._data.length+this.options.startNum||0},e.prototype.setStartNum=function(t){var e=this.options.startNum||1;this.options.order&&t!==e&&(this.options.startNum=t,this._resetOrderNum(t),this.fire("orderchanged",this))},e.prototype.getTableWidth=function(){return this.tableWidth},e.prototype.getTableHeight=function(){return this.tableHeight},e.prototype.addTo=function(t){t&&(this._layer=t,this._tableRows=this.createTable(),this._addToLayer(this._tableRows,!0),this._addEventsToTable())},e.prototype._addEventsToTable=function(){this.options.editable&&this.on("dblclick",function(t){var e=t.context.cell;e&&this._addEditEventToCell(e)});var t=this,e=this.getMap();this.on("click",function(i){e.options.doubleClickZoom=!1,t.prepareAdjust()})},e.prototype.getLayer=function(){return this._layer},e.prototype.getMap=function(){return this._layer?this._layer.getMap():null},e.prototype.getCenter=function(){return this.getCoordinates()},e.prototype.getCoordinates=function(){var t=this.options.position;return new maptalks.Coordinate(t.x,t.y)},e.prototype.animate=function(t,e,i){var o=this.getAllCells();if(o&&o.length>0)for(var a=0,s=o.length;a<s;a++)o[a].animate(t,e,i)},e.prototype._initRowHeightAndColWidth=function(){if(0===this._rowHeights.length||0===this._colWidths.length){for(var t=0;t<this._colNum;t++)this._colWidths[t]=0;for(var e=0;e<this._rowNum;e++)this._rowHeights[e]=0;this.options.header&&this._calculateHeaderHeight(),this._calculateRowHeight()}for(var i=0;i<this._rowHeights.length;i++)this.tableHeight+=this._rowHeights[i];for(var o=0;o<this._colWidths.length;o++)this.tableWidth+=this._colWidths[o]},e.prototype._calculateHeaderHeight=function(){for(var t=0,e=this._columns.length;t<e;t++){var i=this._columns[t],o=i.header,a=this.getCellSymbol(0,t),s=maptalks.StringUtil.getFont(a),r=maptalks.StringUtil.stringLength(o,s);this._colWidths[t]=r.width,this._rowHeights[0]<r.height&&(this._rowHeights[0]=r.height)}},e.prototype._calculateRowHeight=function(){var t=0;this.options.header&&(t=1);for(var e=0,i=this._data.length;e<i;e++)for(var o=this._data[e],a=0,s=this._columns.length;a<s;a++){var r=this._columns[a],n=o[r.dataIndex],h=r.maxWidth||this._cellWidth,l=0,d=this.getCellSymbol(e+t,a),_=maptalks.StringUtil.getFont(d),g=maptalks.StringUtil.stringLength(n,_);l=g.width>=h?h:g.width<=this._colWidths[a]?this._colWidths[a]:g.width,d.textWrapWidth=l,this._colWidths[a]=l;var u=maptalks.StringUtil.splitTextToRow(n,d),c=u.size;this._rowHeights[e+t]<c.height&&(this._rowHeights[e+t]=c.height)}},e.prototype._initCellSymbol=function(){for(var t={},e=this.options.headerSymbol||this.options.symbol,i=this.options.symbol,o=0;o<this._rowNum;o++)if(0===o&&this.options.header)for(var a=0;a<this._colNum;a++)e.textWrapWidth=this._colWidths[a],t[o+"_"+a]=e;else for(var s=0;s<this._colNum;s++)i.textWrapWidth=this._colWidths[s],t[o+"_"+s]=i;return t},e.prototype.hide=function(){for(var t,e=0,i=this._tableRows.length;e<i;e++){if(!(t=this._tableRows[e]))return;for(var o=0,a=t.length;o<a;o++)t[o].isEditingText()&&t[o].endEditText(),t[o].hide()}this.fire("hide",this),this.options.visible=!1},e.prototype.show=function(){for(var t,e=0,i=this._tableRows.length;e<i;e++){if(!(t=this._tableRows[e]))return;for(var o=0,a=t.length;o<a;o++)t[o].show()}this.options.visible=!0},e.prototype.isVisible=function(){return this.options.visible},e.prototype.orderNumberIsVisible=function(){return this.options.showOrderNumber},e.prototype.showOrderNumber=function(){this._showNumLabel(),this.options.showOrderNumber=!0},e.prototype.hideOrderNumber=function(){this._hideNumLabel(),this.options.showOrderNumber=!1},e.prototype.getAllCells=function(){for(var t,e=[],i=0,o=this._tableRows.length;i<o;i++)if(t=this._tableRows[i])for(var a=0,s=t.length;a<s;a++)e.push(t[a]);return this.options.dynamic&&this.options.order&&(e=e.concat(this._geometryNumLabels)),e},e.prototype.remove=function(){this.stopEditTable();for(var t,e=0,i=this._tableRows.length;e<i;e++){if(!(t=this._tableRows[e]))return;for(var o=0,a=t.length;o<a;o++)t[o].remove()}this._tableRows=[],this.fire("remove",this),this._deleteTable(),this.clearLinker(),this.unLink()},e.prototype.setZIndex=function(t){this._zindex=t;for(var e=0;e<this._rowNum;e++){var i=this._tableRows[e];if(!i)return;for(var o=0,a=i.length;o<a;o++)i[o].setZIndex(t)}},e.prototype.getZIndex=function(){return this._zindex},e.prototype.bringToFront=function(){for(var t=0;t<this._rowNum;t++){var e=this._tableRows[t];if(!e)return;for(var i=0,o=e.length;i<o;i++)e[i].bringToFront()}},e.prototype.bringToBack=function(){for(var t=0;t<this._rowNum;t++){var e=this._tableRows[t];if(!e)return;for(var i=0,o=e.length;i<o;i++)e[i].bringToBack()}},e.prototype.stopEditTable=function(){for(var t,e=0,i=this._tableRows.length;e<i;e++){if(!(t=this._tableRows[e]))return;for(var o=0,a=t.length;o<a;o++)t[o].isEditingText()&&t[o].endEditText()}},e.prototype.isEditing=function(){return this.options.editing},e.prototype._deleteTable=function(){delete this._initalColumns,delete this._headAttributes,delete this._columns,delete this._colNum,delete this._data,delete this._initalData,delete this._rowNum,delete this.tableWidth,delete this.tableHeight,delete this._cellWidth,delete this._cellHeight,delete this._currentRow,delete this._currentCol,delete this._rowHeights,delete this._colWidths,delete this.options,delete this._tableRows,delete this._layer,delete this._adjustLayer,delete this},e.prototype.refreshData=function(t,e){for(var i=this.getData(),o=this._getUpdateItems(i,t,e),a=this._getMinusItems(i,t,e),s=this._getMinusItems(t,i,e),r=0;r<o.length;r++)this.updateRow(o[r].maptalks_order,o[r]);for(var n=a.length-1;n>=0;n--)this.removeRow(a[n].maptalks_order);var h=0;this.options.header&&(h=1);for(var l=this.getData().length-1,d=0;d<s.length;d++)this.addRow(l+d+h,s[d],!0)},e.prototype._uniquelize=function(t,e){if(!e)return[];for(var i=[],o=0;o<t.length;o++){for(var a=!0,s=0;s<i.length;s++)if(t[o][e]===i[s][e]){a=!1;break}a&&i.push(t[o])}return i},e.prototype._getUpdateItems=function(t,e,i){if(!i)return[];var o=[];t=this._uniquelize(t,i);for(var a=0;a<t.length;a++)for(var s=0;s<e.length;s++)if(e[s][i]===t[a][i]){e[s].maptalks_order=t[a].maptalks_order,o.push(e[s]);break}return o},e.prototype._getMinusItems=function(t,e,i){if(!i)return[];var o=[];t=this._uniquelize(t,i);for(var a=0;a<t.length;a++){for(var s=!0,r=0;r<e.length;r++)e[r][i]===t[a][i]&&(s=!1);s&&o.push(t[a])}return o},e.prototype.setCoordinates=function(t){var e=new maptalks.Coordinate(t.x,t.y),i=e.substract(this.getCenter());this._translate(i),this.fire("positonchanged",this)},e.prototype._addToLayer=function(t,e){for(var i=void 0,o=void 0,a=0,s=t.length;a<s;a++){if(!(i=t[a]))return;for(var r=0,n=i.length;r<n;r++)o=i[r],e&&(o._row=a,o._col=r),this._addEventsToCell(o).addTo(this._layer)}},e.prototype._showHeaderItemMenu=function(t,e){for(var i=[],o=void 0,a=void 0,s=void 0,r=this,n=0,h=this._headAttributes.length;n<h;n++)o=this._headAttributes[n],a=o.displayName,s={item:a,click:function(e){r._changeHeader(e,t)}},i.push(s);var l={width:160,maxHeight:300,items:i};this.getMap().setMenu(l).openMenu(e)},e.prototype._changeHeader=function(t,e){var i=t.index,o=this._headAttributes[i];e.dataIndex=o.name,e.setContent(o.displayName),this._setColData(e);var a=e._col;this._columns[a]={header:o.displayName,dataIndex:o.name,type:"string"}},e.prototype._setColData=function(t){for(var e=t.dataIndex,i=t._col,o=[],a=void 0,s=0,r=this._initalData.length;s<r;s++)a=this._initalData[s],o[s+1]=a[e];for(var n=void 0,h=1,l=this._tableRows.length;h<l;h++){if(!(n=this._tableRows[h]))return;t=n[i],t.setContent(o[h])}},e.prototype._translate=function(t){for(var e=void 0,i=void 0,o=0,a=this._tableRows.length;o<a;o++){if(!(e=this._tableRows[o]))return;for(var s=0,r=e.length;s<r;s++)i=e[s],i.translate(t),0===o&&0===s&&(this.options.position=i.getCenter())}},e.prototype._addMouseoverEvent=function(t){t.context=this,this.table.fire("mouseover",t)},e.prototype._addMouseoutEvent=function(t){t.context=this,this.table.fire("mouseout",t)},e.prototype._addMousedownEvent=function(t){t.context=this,this.table.fire("mousedown",t)},e.prototype._addClickEvent=function(t){t.context=this,this.table.fire("click",t)},e.prototype._addDBLClickEvent=function(t){t.context=this,this.table.fire("dblclick",t)},e.prototype._addContextmenuEvent=function(t){t.context=this,this.table.fire("contextmenu",t)},e.prototype._addEditTableEvent=function(t){t.context=this,this.table.fire("edittablestart",t),this.table.options.editing=!0},e.prototype.createTable=function(){for(var t,e=[],i=0;i<this._rowNum;i++)0===i&&this.options.header?e.push(this.createHeader()):(t=this._data[i],this._data&&this._data.length>0&&(this.options.header&&(t=this._data[i-1]),t&&e.push(this._createRow(i,t))));return e},e.prototype.getColumns=function(){var t=this.options.columns;if(!t){t=[];var e=this.options.data,i=void 0,o=void 0;for(var a in e)i=this._getDataType(e[a]),o={header:a,dataIndex:a,type:i},t.push(o)}return t},e.prototype._getDataType=function(t){var e="string";return maptalks.isNumber(t)&&(e="number"),e},e.prototype.setTableStyle=function(t,e,i){if(i){for(var o=0;o<this._rowNum;o++)this._setRowStyle(o,t,e);this._changeDefaultSymbol(t,e)}else{var a=this._currentRow,s=this._currentCol;a>-1&&this._setRowStyle(a,t,e),s>-1&&this._setColStyle(s,t,e)}},e.prototype._setRowStyle=function(t,e,i){for(var o=this._tableRows[t],a=0,s=o.length;a<s;a++){var r=o[a],n=r.getSymbol(),h=i;"textFont"===e&&(h=i+" "+n.textSize+"px "+n.textFaceName),this._setStyleToCell(r,e,h)}},e.prototype._setColStyle=function(t,e,i){for(var o=0,a=this._tableRows.length;o<a;o++){var s=this._tableRows[o],r=s[t],n=r.getSymbol(),h=i;"textFont"===e&&(h=i+" "+n.textSize+"px "+n.textFaceName),this._setStyleToCell(r,e,h)}},e.prototype._setStyleToCell=function(t,e,i){var o=t.getSymbol();"textAlign"===e?(o.textHorizontalAlignment=i,"left"===i?o.textDx-=t.getSize.width/2:"right"===i&&(o.textDx+=t.getSize.width/2),t.setSymbol(o)):(o[e]=i,t.setSymbol(o))},e.prototype._changeDefaultSymbol=function(t,e){var i=this.options.symbol;"textAlign"===t?i.textHorizontalAlignment=e:"textFont"===t?e=e+" "+i.textSize+"px "+i.textFaceName:"markerFill"===t?i.fill=e:"markerLineColor"===t&&(i.lineColor=e),i[t]=e,this.options.symbol=i},e}(maptalks.JSONAble(maptalks.Eventable(maptalks.Handlerable(maptalks.Class))));h.mergeOptions(r),h.registerJSONType("Table"),h.include({createCell:function(t,e,i,o){var a=o.textSize||12,s=o.textLineSpacing||8;t=this._filterContent(t);var r={symbol:{markerLineColor:o.lineColor||"#ffffff",markerLineWidth:1,markerLineOpacity:.9,markerLineDasharray:null,markerFill:o.fill||"#4e98dd",markerFillOpacity:.9,markerDx:e.dx||0,markerDy:e.dy||0,textFaceName:o.textFaceName||"microsoft yahei",textSize:a,textFill:o.textFill||"#ff0000",textOpacity:1,textSpacing:30,textWrapWidth:i.width,textWrapBefore:!1,textLineSpacing:s,textHorizontalAlignment:o.textHorizontalAlignment||"middle",textVerticalAlignment:o.textVerticalAlignment||"middle",textWeight:o.textWeight,textStyle:o.textStyle,textDx:e.dx||0,textDy:e.dy||0},boxPadding:{width:15,height:8},draggable:!1,boxAutoSize:!1,boxMinWidth:i.width,boxMinHeight:i.height},n=this.options.position;return new maptalks.TextBox(t,n,r)},getCellOffset:function(t,e){var i=0,o=0,a=this._cellWidth/2,s=this._cellHeight/2;this._rowHeights[t]&&(a=this._rowHeights[t]/2),this._colWidths[e]&&(s=this._colWidths[e]/2);for(var r=0;r<t;r++)o+=this._rowHeights[r];o+=a;for(var n=0;n<e;n++)i+=this._colWidths[n];return i+=s,{dx:i,dy:o}},getCellSymbol:function(t,e){var i=this.options.symbol;if(this.tableSymbols){var o=this.tableSymbols[t+"_"+e];if(o)return o.textLineSpacing||(o.textLineSpacing=i.textLineSpacing),o}return i},getRowNum:function(t){return t._row},getColNum:function(t){return t._col},_addEventsToCell:function(t){var e={table:this,cell:t,row:t._row,col:t._col,dataIndex:t.dataIndex};return t.on("mouseover",this._addMouseoverEvent,e).on("mouseout",this._addMouseoutEvent,e).on("mousedown",this._addMousedownEvent,e).on("click",this._addClickEvent,e).on("dblclick",this._addDBLClickEvent,e).on("contextmenu",this._addContextmenuEvent,e).on("symbolchange",this._cellSymbolChangeEvent,e).on("edittextstart",this._addEditTableEvent,e).on("edittextend",this._cellEditTextEnd,e),t},_cellSymbolChangeEvent:function(t){t.context=this;var e=this.table,i=this.cell;e.fire("symbolchange",t);var o=this.cell.getSymbol();e.tableSymbols[i._row+"_"+i._col]=e.convertCellToSaveSymbol(o)},_cellEditTextEnd:function(t){t.context=this;var e=this.table,i=this.cell,o=i._row,a=i._col,s=e._columns[a],r=s.dataIndex;e.options.header?o>0?(o-=1,e._data[o][r]=i.getContent()):e._columns[a].header=i.getContent():e._data[o][r]=i.getContent(),this.table.fire("edittableend",t),this.table.options.editing=!1},convertCellToSaveSymbol:function(t){return{fill:t.markerFill,lineColor:t.markerLineColor,textFaceName:t.textFaceName,textFill:t.textFill,textSize:t.textSize,textWrapWidth:t.textWrapWidth,textHorizontalAlignment:t.textHorizontalAlignment,textWeight:t.textWeight,textStyle:t.textStyle}},_addEditEventToCell:function(t){t.startEditText();var e=t._textEditor;e.focus();var i=e.value;e.value="","\u7a7a"!==i&&(e.value=i);var o=this;t.on("remove",function(){t.isEditingText()&&t.endEditText()}),t.on("edittextend",function(){var e=t.getContent(),i=t._row,a=t._col,s=o._columns[a].dataIndex;o.options.header&&i>0?o._data[i-1][s]=e:o._columns[a].header=e})},_addNumberLabelToGeometry:function(t,e){var i=this,o=e.getSymbol(),a={symbol:this._convertCellSymbolToNumberSymbol(o),draggable:!1,boxAutoSize:!1,boxMinWidth:20,boxMinHeight:20},s=e.getContent(),r=new maptalks.Label(s,t,a);this.getLayer().addGeometry(r),this._geometryNumLabels.push(r);var n=this;e.on("remove",function(){n._removeNumLabel(r)},this),e.on("hide",function(){r.hide()},this),e.on("show",function(){r.show()},this),e.on("contentchange",function(){var t=0;i.options.header&&(t=-1);var o=e._row+t,a=i._data[o],s=a.coordinate;s&&r.setCoordinates(new maptalks.Coordinate(s.x,s.y))},this),e.on("symbolchange",function(){var t=i._convertCellSymbolToNumberSymbol(e.getSymbol());r.setSymbol(t)},this),e.on("positionchanged contentchange",function(){var t=e.getContent();r.setContent(t)},this)},_hideNumLabel:function(){for(var t=0;t<this._geometryNumLabels.length;t++)this._geometryNumLabels[t].hide()},_showNumLabel:function(){for(var t=0;t<this._geometryNumLabels.length;t++)this._geometryNumLabels[t].show()},_removeNumLabel:function(t){for(var e=0;e<this._geometryNumLabels.length;e++)if(t.getContent()===this._geometryNumLabels[e].getContent()){this._geometryNumLabels[e].remove(),this._geometryNumLabels.splice(e,1);break}},_convertCellSymbolToNumberSymbol:function(t){return{markerType:"ellipse",markerLineColor:"#ffffff",markerLineWidth:0,markerLineOpacity:t.markerLineOpacity||0,markerFill:t.markerFill||"#4e98dd",markerFillOpacity:t.markerFillOpacity||1,markerDx:0,markerDy:0,markerHeight:30,markerWidth:30,textFaceName:t.textFaceName||"microsoft yahei",textSize:t.textSize||12,textFill:t.textFill||"#ff0000",textOpacity:t.textOpacity||1,textSpacing:t.textSpacing||0,textWrapBefore:!1,textLineSpacing:t.textLineSpacing||0,textHorizontalAlignment:t.textHorizontalAlignment||"middle",textVerticalAlignment:t.textVerticalAlignment||"middle",textDx:0,textDy:0}},_filterContent:function(t){return t+="",t.replace(/\r/gi,"").replace(/\v/gi,"").replace(/\f/gi,"").replace(/\t/gi,"").replace(/\b/gi,"").replace(/\n\n/gi,"\n")},isNumber:function(t){return"number"==typeof t&&!isNaN(t)}}),h.include({addCol:function(t,e,i){var o=t+1;return i||(o=t),this._createCol(o,e,!0),this},removeCol:function(t){this.stopEditTable();for(var e=this._tableRows[0],i=e[t],o=i.getSize(),a=this.options.position,s=this._layer.getMap(),r=void 0,n=void 0,h=void 0,l=void 0,d=void 0,_=void 0,g=void 0,u=void 0,c=0,p=this._tableRows.length;c<p;c++){if(!(r=this._tableRows[c]))return;for(var m=t,f=r.length;m<f;m++)n=r[m],0===c&&m===t&&(this.tableWidth-=o.width),m>t?(this._translateDx(n,1-o.width),0===c&&this._adjustCols&&(h=this._adjustCols[n._col],l=n.getSize(),d=n.getSymbol(),_=d.textDx,g=s.locate(a,s.pixelToDistance(l.width/2+_,0),s.pixelToDistance(0,l.height/2)),u=s.locate(g,0,-s.pixelToDistance(0,this.tableHeight)),h.setCoordinates([g,u])),n._col-=1):n.remove();this._tableRows[c].splice(t,1),this.options.header?c>0&&delete this._data[c-1][i.dataIndex]:delete this._data[c][i.dataIndex]}this._colWidths.splice(t,1),this._columns.splice(t,1),this._colNum-=1},moveCol:function(t,e){this.stopEditTable();var i=t;"left"===e?t>0&&(i=t-1):"right"===e&&t<this._colNum-1&&(i=t+1),this._changeColOrder(t,i)},getColumnNum:function(){return this._colNum},getColumn:function(t){for(var e=[],i=0;i<this._rowNum;i++)e.push(this._tableRows[i][t]);return e},getColumnWidth:function(t){return this._colWidths[t]},setColumnWidth:function(t,e){var i=this.getColumnWidth(t),o=e-i;this.setColumnOffset(t,o)},setColumnOffset:function(t,e){this._colWidths[t]+=e;for(var i=this._colWidths[t],o=void 0,a=void 0,s=void 0,r=0,n=this._tableRows.length;r<n;r++){if(!(o=this._tableRows[r]))return;for(var h=t,l=o.length;h<l;h++)a=o[h],s=a.getSymbol(),h===t?(a.options.boxMinWidth=i,s.markerWidth=a.options.boxMinWidth,s.textWrapWidth=a.options.boxMinWidth,s.markerDx+=e/2,s.textDx+=e/2):(s.markerDx+=e,s.textDx+=e),a.setSymbol(s)}this.tableWidth+=e;var d={};d.target=this,d.columnNum=t,d.widthOffset=new maptalks.Point(e,0),this.fire("widthchanged",d)},_createCol:function(t,e,i){var o=t;e&&0!==e.length||(e="");var a=[],s=1,r=void 0;if(maptalks.Util.isArrayHasData(e[0])){s=e.length,r=[];for(var n=0,h=e.length;n<h;n++)for(var l=0;l<this._rowNum;l++){var d=this._addCellForColumn(e[n][0],e[n][l],l,t+n,i);this._tableRows[l].splice(t+n,0,d)}a.push(r)}else for(var _=0;_<this._rowNum;_++){var g=this._addCellForColumn(e[0],e[_],_,t,i);this._tableRows[_].splice(t,0,g)}this._colNum+=s,this._adjustDatasetForCol(o,s)},_addCellForColumn:function(t,e,i,o,a){var s=void 0,r=void 0,n=void 0,h=void 0,l=void 0;if(a){var d=o-1,_=this.getCellOffset(i,d),g=this._colWidths[d];s=0===i?{dx:_.dx+(g+this._cellWidth)/2,dy:_.dy}:this.getCellOffset(i,o),r=this.options.symbol,this.options.header&&0===i&&(r=this.options.headerSymbol),h=this._cellWidth,n=new maptalks.Size(this._cellWidth,this._rowHeights[i])}else s=this.getCellOffset(i,o),r=this.getCellSymbol(i,o),h=this._colWidths[o],n=new maptalks.Size(h,this._rowHeights[i]);if(0===i){var u={header:t,dataIndex:t,type:"string"};this._columns.splice(o,0,u),l=this.createCell(t,s,n,r),this.tableWidth+=h,this._colWidths.splice(o,0,h)}else l=this.createCell(e,s,n,r),this.options.header&&--i,this._data[i][t]=e;return l._row=i,l._col=o,l.dataIndex=t,this.tableSymbols[i+"_"+o]=r,this._addEventsToCell(l).addTo(this._layer),l},_changeColOrder:function(t,e){if(t!==e){var i=this._tableRows[0],o=i[t],a=o._row,s=o._col,r=this._colWidths[t],n=this.getCellOffset(a,s).dx,h=i[e],l=h._row,d=h._col,_=this._colWidths[e],g=this.getCellOffset(l,d).dx;n<g?(n+=_,g-=r):(n-=_,g+=r);for(var u=void 0,c=void 0,p=void 0,m=void 0,f=0,v=this._tableRows.length;f<v;f++){if(!(u=this._tableRows[f]))return;c=u[t].getSymbol(),c.markerDx=n,c.textDx=n,u[t].setSymbol(c),u[t]._col=e,p=u[e].getSymbol(),p.markerDx=g,p.textDx=g,u[e].setSymbol(p),u[e]._col=t,m=u[t],u[t]=u[e],u[e]=m}this._colWidths[t]=this._colWidths[e],this._colWidths[e]=r;var b=this._columns[t];this._columns[t]=this._columns[e],this._columns[e]=b}},_adjustDatasetForCol:function(t,e){for(var i=this.options.position,o=this._layer.getMap(),a=void 0,s=void 0,r=void 0,n=void 0,h=void 0,l=void 0,d=void 0,_=void 0,g=0,u=this._tableRows.length;g<u;g++){if(!(a=this._tableRows[g]))return;for(var c=t+1,p=a.length;c<p;c++)s=a[c],s._col+=e,s.fire("symbolchange",s),this._translateDx(s,this._cellWidth),0===g&&this._adjustCols&&(r=this._adjustCols[c],n=s.getSize(),h=s.getSymbol(),l=h.textDx,d=o.locate(i,o.pixelToDistance(n.width/2+l,0),o.pixelToDistance(0,n.height/2)),_=o.locate(d,0,-o.pixelToDistance(0,this.tableHeight)),r.setCoordinates([d,_]))}},_translateDx:function(t,e){var i=t.getSymbol();i.markerDx+=e,i.textDx+=e,t.setSymbol(i)}});var l=maptalks.INTERNAL_LAYER_PREFIX+"_drag_stage",d=maptalks.Browser.touch?"touchstart mousedown":"mousedown",_=function(t){function e(i){return o(this,e),s(this,t.call(this,i))}return a(e,t),e.prototype.addHooks=function(){this.target.on(d,this._startDrag,this)},e.prototype.removeHooks=function(){this.target.off(d,this._startDrag,this)},e.prototype._startDrag=function(t){if(this.target.getMap()&&!this._isDragging){var e=t.domEvent;e.touches&&e.touches.length>1||(this.target.on("click",this._endDrag,this),this._lastPos=t.coordinate,this._prepareMap(),this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this._moved=!1,this.target.fire("dragstart",t))}},e.prototype._prepareMap=function(){var t=this.target.getMap();this._mapDraggable=t.options.draggable,this._mapHitDetect=t.options.hitDetect,t._trySetCursor("move"),t.config({hitDetect:!1,draggable:!1})},e.prototype._prepareDragHandler=function(){var t=this.target.getMap();this._dragHandler=new maptalks.DragHandler(t._panels.mapWrapper||t._containerDOM),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},e.prototype._prepareShadow=function(){var t=this.target;this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var e=t.tableWidth,i=t.tableHeight;this._shadow=new maptalks.Marker(t.getCenter(),{draggable:!0,symbol:{markerType:"square",markerLineColor:"#ffffff",markerLineDasharray:[5,5,2,5],markerFill:"#4e98dd",markerFillOpacity:.2,markerWidth:e,markerHeight:i,markerDx:e/2,markerDy:i/2}});var o=this._shadow;if(t.options.dragShadow){var a=maptalks.Util.decreaseSymbolOpacity(o._getInternalSymbol(),.5);o.setSymbol(a)}o.setId(null);var s=[];this._shadowConnectors=s,this._dragStageLayer.bringToFront().addGeometry(s.concat(o))},e.prototype._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target.getSymbol())},e.prototype._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(l),this._dragStageLayer||(this._dragStageLayer=new maptalks.VectorLayer(l,{drawImmediate:!0}),t.addLayer(this._dragStageLayer)),this._dragStageLayer._getRenderer()._resources=e._getRenderer()._resources},e.prototype._dragging=function(t){var e=this.target,i=e.getMap(),o=i._parseEvent(t.domEvent),a=o.domEvent;if(!(a.touches&&a.touches.length>1)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._prepareMap(),this._isDragging=!0,this._prepareShadow(),void this._shadow._fireEvent("dragstart",o);if(this._shadow){var s=o.coordinate;this._lastPos||(this._lastPos=s);var r=s.substract(this._lastPos),n=this._shadow.options.dragOnAxis;"x"===n?r.y=0:"y"===n&&(r.x=0),this._lastPos=s,this._shadow.translate(r),o.coordOffset=r,this._shadow._fireEvent("dragging",o),e.fire("dragging",o)}}},e.prototype._endDrag=function(t){var e=this.target,i=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),i){var o;i&&(o=i._parseEvent(t.domEvent)),e.off("symbolchange",this._onTargetUpdated,this);var a=this._shadow;a&&(e.setCoordinates(a.getCoordinates()),a._fireEvent("dragend",o),a.remove(),delete this._shadow),this._shadowConnectors&&(i.getLayer(l).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),delete this._lastPos,i._trySetCursor("default"),maptalks.Util.isNil(this._mapDraggable)&&(this._mapDraggable=!0),i.config({hitDetect:this._mapHitDetect,draggable:!0}),delete this._autoBorderPanning,delete this._mapDraggable,this._isDragging=!1,e.fire("dragend",o)}},e}(maptalks.Handler);h.addInitHook("addHandler","draggable",_),h.include({isDragging:function(){return!!this._isDragging}}),h.include({createHeader:function(){for(var t=[],e=void 0,i=void 0,o=void 0,a=void 0,s=void 0,r=0,n=this._columns.length;r<n;r++){e=this.getCellOffset(0,r),i=this._columns[r],o=i.header,a=new maptalks.Size(this._colWidths[r],this._rowHeights[0]);var h=this.getCellSymbol(0,r);s=this.createCell(o,e,a,h),s._row=0,s._col=r,s.dataIndex=i.dataIndex,t.push(s)}return t}}),h.include({addRow:function(t,e,i){var o=t;i&&(o=t+1);var a=[],s=0;if(e&&0!==e.length)if(maptalks.Util.isArrayHasData(e))for(var r=void 0,n=0,h=e.length;n<h;n++)r=e[n],a.push(this._createRow(o,r,!0)),s+=this._rowHeights[o],o+=1;else{var l=this._createRow(o,e,!0);a.push(l),s+=this._rowHeights[o]}else a.push(this._createRow(o,e,!0));this._addToLayer(a);var d=this._tableRows.slice(0,o),_=this._tableRows.slice(o);return this._adjustDatasetForRow(a.length,_,s),this._tableRows=d.concat(a).concat(_),this._rowNum+=a.length,this.fire("addrow",this),this.fire("orderchanged",this),this.fire("heightchanged",this),this},moveRow:function(t,e){this.stopEditTable();var i=t;"up"===e?t>0&&(i=t-1):"down"===e&&t<this._rowNum-1&&(i=t+1),this._changeRowOrder(t,i)},updateRow:function(t,e){t-=parseInt(this.options.startNum||1);var i=t;this.options.header&&(i=t+1);var o=this._tableRows[i];if(o){this._data[t]=e;for(var a=void 0,s=void 0,r=0;r<this._colNum;r++){a=this._columns[r].dataIndex,s="",e&&e[a]&&(s=e[a]);var n=o[r];n&&(this.options.order&&"maptalks_order"===a&&(s=n.getContent()),n.setContent(s))}}},removeRow:function t(e){this.stopEditTable();for(var t=this._tableRows[e],i=t[0],o=i.getSize(),a=void 0,s=void 0,r=e,n=this._tableRows.length;r<n;r++){if(!(a=this._tableRows[r]))return;for(var h=0,l=a.length;h<l;h++)if(s=a[h],r>e){if(this.options.order&&"maptalks_order"===this._columns[h].dataIndex){var d=this.options.startNum||1;d>1?s.setContent(s._row+d-1):s.setContent(s._row-1),s._row-=1}this._translateDy(s,1-o.height)}else s.remove()}this.tableHeight-=o.height+1,this._tableRows.splice(e,1),this._rowHeights.splice(e,1);var _=0;this.options.header?(this._data.splice(e-1,1),_=e-1):(this._data.splice(e,1),_=e);for(var g=_;g<this._data.length;g++)this._data[g].maptalks_order-=1;this._rowNum-=1,this.fire("removerow",this),this.fire("orderchanged",this),this.fire("heightchanged",this)},getRowsNum:function(){return this._rowNum},getRow:function(t){return this._tableRows[t]},getRowHeight:function(t){return this._rowHeights[t]},setRowHeight:function(t,e){var i=this.getRowHeight(t),o=e-i;this.setRowOffset(t,o)},setRowOffset:function(t,e){this._rowHeights[t]+=e;for(var i=this._rowHeights[t],o=void 0,a=void 0,s=void 0,r=t;r<this._rowNum;r++){o=this._tableRows[r];for(var n=0;n<this._colNum;n++)a=o[n],s=a.getSymbol(),r===t?(a.options.boxMinHeight=i,a.options.boxMinHeight<s.markerHeight&&(s.markerHeight=a.options.boxMinHeight),s.textWrapWidth=i,s.markerDy+=e/2,s.textDy+=e/2):(s.markerDy+=e,s.textDy+=e),a.setSymbol(s),this.tableSymbols[r+"_"+n]=s}this.tableHeight+=e;var h={};h.target=this,h.row=t,h.heightOffset=new maptalks.Point(0,e),this.fire("heightchanged",h)},_createRow:function(t,e,i){
var o=[],a=void 0,s=void 0,r=void 0,n=void 0,h=void 0,l=void 0,d=void 0,_=void 0,g=this._rowHeights[t];g||(g=this._cellHeight);for(var u=0;u<this._colNum;u++){if(a=this._columns[u],s=a.dataIndex,r="",e?e[s]&&(r=e[s]):e={},this.options.order&&"maptalks_order"===s){if(!r||""===r){var c=this.options.startNum||1;r=c>1?t+c-1:t}e[s]=r}if(i){var p=this.getCellOffset(t-1,u);n={dx:p.dx,dy:p.dy+g},_=this.options.symbol,h=new maptalks.Size(this._colWidths[u],g)}else n=this.getCellOffset(t,u),_=this.getCellSymbol(t,u),h=new maptalks.Size(this._colWidths[u],g);l=this.createCell(r,n,h,_),l._row=t,l._col=u,l.dataIndex=s,o[u]=l,this.tableSymbols[t+"_"+u]=_,this.options.dynamic&&this.options.order&&"maptalks_order"===s&&(d=e.coordinate)&&this._addNumberLabelToGeometry(new maptalks.Coordinate(d.x,d.y),l)}return i&&(this._rowHeights.splice(t,0,g),this.options.header&&--t,this._data.splice(t,0,e),this.tableHeight+=g),o},_changeRowOrder:function(t,e){if(t!==e){var i=0;if(this.options.header&&(i=-1),0!==e){var o=this._tableRows[t],a=this._tableRows[e],s=o[0],r=s._row,n=s._col,h=this._rowHeights[r],l=this.getCellOffset(r,n).dy,d=a[0],_=d._row,g=d._col,u=this._rowHeights[_],c=this.getCellOffset(_,g).dy;l<c?(l+=u,c-=h):(l-=u,c+=h);var p=this._data[t+i];this._data[t+i]=this._data[e+i],this._data[e+i]=p;for(var m=0,f=o.length;m<f;m++){var v=o[m].getSymbol();o[m]._row=e,v.markerDy=l,v.textDy=l,o[m].setSymbol(v),this.options.order&&"maptalks_order"===this._columns[m].dataIndex&&(o[m].setContent(e),this._data[e+i].maptalks_order=e,o[m].fire("positionchanged",{target:o[m]}))}for(var b=0,y=a.length;b<y;b++){var w=a[b].getSymbol();a[b]._row=t,w.markerDy=c,w.textDy=c,a[b].setSymbol(w),this.options.order&&"maptalks_order"===this._columns[b].dataIndex&&(a[b].setContent(t),this._data[t+i].maptalks_order=t,a[b].fire("positionchanged",{target:a[b]}))}this._tableRows[e]=o,this._tableRows[t]=a,this._rowHeights[t]=this._rowHeights[e],this._rowHeights[e]=h}}},_adjustDatasetForRow:function(t,e,i){var o=void 0,a=0;this.options.header&&(a=-1);for(var s=0,r=e.length;s<r;s++){o=e[s];for(var n=0,h=o.length;n<h;n++){if(o[n]._row+=t,this.options.order&&"maptalks_order"===this._columns[n].dataIndex){var l=o[n]._row,d=this.options.startNum||1;d>1&&(l+=d),o[n].setContent(l),this._data[o[n]._row+a].maptalks_order=l}o[n].fire("symbolchange",o[n]),this._translateDy(o[n],i)}}return this},_resetOrderNum:function(t){if(this.options.order){var e=0;this.options.header&&(e=-1);var i=0;this.options.header&&(i=1);for(var o=i,a=this._tableRows.length;o<a;o++)for(var s=this._tableRows[o],r=0;r<s.length;r++)if("maptalks_order"===s[r].dataIndex){var n=o+t+e;s[r].setContent(n),s[r].fire("positionchanged",{target:s[r]}),this._data[o+e].maptalks_order=n;break}}},_translateDy:function(t,e){var i=t.getSymbol();i.markerDy+=e,i.textDy+=e,t.setSymbol(i)}}),h.include({linkTo:function(t){!t instanceof maptalks.Table||t.getLinker()||t.getColumnNum()===this.getColumnNum()&&(t.addLinker(this),this._linkTarget=t,this._moveToNewCoordinates(),this._addLinkEvent(),this._autoAdjustColumnWidth(),this.config("draggable",!1),this.config("adjustable","y"))},unLink:function(){this._linkTarget&&(this._removeLinkEvent(),this._linkTarget.clearLinker(),delete this._linkTarget,this.config("draggable",!0),this.config("adjustable",!0))},clearLinker:function(){this._linker=null,delete this._linker},addLinker:function(t){t instanceof maptalks.Table||this._linker||(this._linker=t)},getLinker:function(){return this._linker},_autoAdjustColumnWidth:function(){for(var t=this._linkTarget,e=t.getColumnNum(),i=0;i<e;i++){var o=t.getColumnWidth(i),a=this.getColumnWidth(i);if(a){var s={columnNum:i,widthOffset:new maptalks.Point(o-a,0)};this._adjustColumnWidth(s)}}},_adjustColumnWidth:function(t){var e=t.columnNum,i=t.widthOffset;this._resizeCol(e,i)},_moveToNewCoordinates:function(){var t=this.getMap(),e=this._linkTarget.getCoordinates(),i=t.coordinateToViewPoint(e),o=this._linkTarget.getTableHeight(),a=t.viewPointToCoordinate(i.add(new maptalks.Point(0,o)));this.setCoordinates(a),this.show()},_addLinkEvent:function(){var t=this._linkTarget;t&&(t.on("dragstart",this.hide,this),t.on("hide",this.hide,this),t.on("dragend",this._moveToNewCoordinates,this),t.on("remove",this.unLink,this),t.on("heightchanged positonchanged",this._moveToNewCoordinates,this),t.on("widthchanged",this._adjustColumnWidth,this))},_removeLinkEvent:function(){var t=this._linkTarget;t&&(t.off("dragstart",this.hide,this),t.off("hide",this.hide,this),t.off("dragend",this._moveToNewCoordinates,this),t.off("remove",this.unLink,this),t.off("heightchanged positonchanged",this._moveToNewCoordinates,this),t.off("widthchanged",this._adjustColumnWidth,this))}});var g=maptalks.INTERNAL_LAYER_PREFIX+"_table_adjust_layer";h.include({prepareAdjust:function(){this.options.adjustable&&this.getMap()&&this.options.header&&(this._prepareEditLayer(),this._bindTableEvent())},_prepareEditLayer:function(){var t=this.getMap(),e=this.getCoordinates(),i=t.coordinateToViewPoint(e),o=g;this._adjustLayer=t.getLayer(o),this._adjustLayer?(this._clearAdjustLayer(),this._adjustLayer.bringToFront()):(this._adjustLayer=new maptalks.VectorLayer(o),t.addLayer(this._adjustLayer)),"x"===this.options.adjustable?this._topLines=this._createTopHandleLine(i):"y"===this.options.adjustable?this._bottomLines=this._createBottomHandleLine(i):(this._topLines=this._createTopHandleLine(i),this._bottomLines=this._createBottomHandleLine(i))},_createTopHandleLine:function(t){for(var e=this,i=this.getMap(),o=this.getTableHeight(),a=[],s=0,r=0;r<this.getColumnNum();r++)!function(r){var n=t.add(new maptalks.Point(s+10,0)),h=i.viewPointToCoordinate(n);n.y=0,h.y=0,s+=e.getColumnWidth(r);var l=i.viewPointToCoordinate(t.add(new maptalks.Point(s,0))),d=i.viewPointToCoordinate(t.add(new maptalks.Point(s,o))),_=new maptalks.LineString([l,d],{id:"__table_top_adjust_line_id_"+r,draggable:!0,dragShadow:!1,dragOnAxis:"x",cursor:"ew-resize",symbol:{lineColor:"#ffffff",lineWidth:3,lineOpacity:.3}}),g=e;_.on("dragging",function(t){var e=_.getId();if(e){var o=parseInt(e.substring(e.lastIndexOf("_")+1)),a=t.coordOffset,s=t.pointOffset,r=t.coordinate;if(r.y=0,r.x<h.x){a=h.substract(r),_.options.dragShadow?_.draggable._shadow.translate(a):_.translate(a),_.draggable._endDrag(t);var l=g.getColumnWidth(o),d=n.add(new maptalks.Point(l-10,0)),u=i.viewPointToCoordinate(d);u.y=0,a=h.substract(u),s=n.substract(d)}g._resizeCol(o,s),g._translateTopHandleLine(o,a)}}),_.on("dragstart",function(t){g._isDragging=!1,g._removeBottomLines()}),_.on("dragend",function(t){g._isDragging=!0}),_.on("mouseover",function(t){_.setSymbol({lineColor:"#ff0000",lineWidth:2})}),_.on("mouseout",function(t){_.setSymbol({lineColor:"#ffffff",lineWidth:3,lineOpacity:.3})}),a.push(_)}(r);return this._adjustLayer.addGeometry(a),a},_translateTopHandleLine:function(t,e){for(var i=t+1;i<this._topLines.length;i++)this._topLines[i].translate(e)},_createBottomHandleLine:function(t){for(var e=this,i=this.getMap(),o=this.getTableWidth(),a=[],s=0,r=0;r<this.getRowsNum();r++)!function(r){var n=t.add(new maptalks.Point(0,s+10)),h=i.viewPointToCoordinate(n);s+=e.getRowHeight(r);var l=i.viewPointToCoordinate(t.add(new maptalks.Point(0,s))),d=i.viewPointToCoordinate(t.add(new maptalks.Point(o,s))),_=new maptalks.LineString([l,d],{id:"__table_bottom_adjust_line_id_"+r,draggable:!0,dragShadow:!1,dragOnAxis:"y",cursor:"ns-resize",symbol:{lineColor:"#ffffff",lineWidth:3,lineOpacity:.3}}),g=e;_.on("dragging",function(t){var e=_.getId();if(e){var o=parseInt(e.substring(e.lastIndexOf("_")+1)),a=t.coordOffset,s=t.pointOffset,r=new maptalks.Coordinate(0,t.coordinate.y);if(n.x=0,h.x=0,r.y>h.y){var l=h.substract(r);_.options.dragShadow?_.draggable._shadow.translate(l):_.translate(l),_.draggable._endDrag(t);var d=g.getRowHeight(o),u=n.add(new maptalks.Point(0,d-10)),c=i.viewPointToCoordinate(u);c.x=0,a=h.substract(c),s=n.substract(u)}g._resizeRow(o,s),g._translateBottomHandleLine(o,a)}}),_.on("dragstart",function(t){g._isDragging=!1,g._removeTopLines()}),_.on("dragend",function(t){g._isDragging=!0}),_.on("mouseover",function(t){_.setSymbol({lineColor:"#ff0000",lineWidth:2})}),_.on("mouseout",function(t){_.setSymbol({lineColor:"#ffffff",lineWidth:3,lineOpacity:.3})}),a.push(_)}(r);return this._adjustLayer.addGeometry(a),a},_translateBottomHandleLine:function(t,e){for(var i=t+1;i<this._bottomLines.length;i++)this._bottomLines[i].translate(e)},_bindTableEvent:function(){var t=this.getMap(),e=this;this.on("hide remove dragstart",function(t){e._clearAdjustLayer()}),this.on("mouseout",function(e){t.options.doubleClickZoom=!0}),t.on("movestart zoomstart resize",function(t){e._clearAdjustLayer()})},_clearAdjustLayer:function(){this._adjustLayer.clear()},_removeTopLines:function(){this._adjustLayer.removeGeometry(this._topLines),this._topLines.splice(0,this._topLines.length)},_removeBottomLines:function(){this._adjustLayer.removeGeometry(this._bottomLines),this._bottomLines.splice(0,this._bottomLines.length)},_resizeRow:function(t,e){var i,o,a,s=e.y,r=this._rowHeights[t]+s;this.tableHeight+=s,this._rowHeights[t]=r;for(var n=t;n<this._rowNum;n++){i=this._tableRows[n];for(var h=0;h<this._colNum;h++)o=i[h],a=o.getSymbol(),n===t?(o.options.boxMinHeight=r,o.options.boxMinHeight<a.markerHeight&&(a.markerHeight=o.options.boxMinHeight),a.markerDy+=s/2,a.textDy+=s/2):(a.markerDy+=s,a.textDy+=s),o.setSymbol(a)}var l={};l.target=this,l.row=t,l.heightOffset=e,this.fire("heightchanged",l)},_resizeCol:function(t,e){var i=e.x,o=void 0,a=void 0,s=void 0,r=this._colWidths[t]+i;this.tableWidth+=i,this._colWidths[t]=r;for(var n=0,h=this._tableRows.length;n<h;n++){if(!(o=this._tableRows[n]))return;for(var l=t,d=o.length;l<d;l++)a=o[l],s=a.getSymbol(),l===t?(a.options.boxMinWidth=r,s.markerWidth=a.options.boxMinWidth,s.textWrapWidth=a.options.boxMinWidth,s.markerDx+=i/2,s.textDx+=i/2):(s.markerDx+=i,s.textDx+=i),a.setSymbol(s)}var _={};_.target=this,_.columnNum=t,_.widthOffset=e,this.fire("widthchanged",_)}}),t.Table=h,Object.defineProperty(t,"__esModule",{value:!0})});